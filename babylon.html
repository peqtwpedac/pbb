<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Babylon - 3D Cube Animation</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #renderCanvas {
            width: 100%;
            height: 100vh;
            touch-action: none;
        }
    </style>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
</head>
<body>
    <canvas id="renderCanvas"></canvas>
    
    <script>
        const canvas = document.getElementById("renderCanvas");
        const engine = new BABYLON.Engine(canvas, true);
        let counter = 0
        const createScene = function() {
            // Create scene
            const scene = new BABYLON.Scene(engine);
            scene.clearColor = new BABYLON.Color3(0.6, 0.7, 0.9);

            // Create camera
            const camera = new BABYLON.ArcRotateCamera(
                "camera",
                Math.PI / 2,
                Math.PI / 3,
                5,
                BABYLON.Vector3.Zero(),
                scene
            );
            camera.attachControl(canvas, true);

            // Create light
            const light = new BABYLON.HemisphericLight(
                "light",
                new BABYLON.Vector3(0, 1, 0),
                scene
            );
            light.intensity = 0.8;

            // Create cube
            const cube = BABYLON.MeshBuilder.CreateBox(
                "cube",
                { size: 2 },
                scene
            );
            cube.checkCollisions = true;

            // Add material to cube
            const material = new BABYLON.StandardMaterial("cubeMaterial", scene);
            material.diffuseColor = new BABYLON.Color3(0.3, 0.6, 1);
            material.specularColor = new BABYLON.Color3(1, 1, 1);
            material.specularPower = 64; // Higher = shinier surface
            material.emissiveColor = new BABYLON.Color3(0.1, 0.2, 0.3); // Glow effect
            material.ambientColor = new BABYLON.Color3(0.2, 0.3, 0.4);
            material.alpha = 0.95; // Slight transparency
            
            // Add reflection
            material.reflectionTexture = new BABYLON.CubeTexture("https://playground.babylonjs.com/textures/skybox", scene);
            material.reflectionTexture.coordinatesMode = BABYLON.Texture.SPHERICAL_MODE;
            material.reflectionTexture.level = 0.3; // Reflection intensity
            
            cube.material = material;

            // Create ground
            const ground = BABYLON.MeshBuilder.CreateGround(
                "ground",
                { width: 20, height: 20 },
                scene
            );
            const groundMaterial = new BABYLON.StandardMaterial("groundMaterial", scene);
            groundMaterial.diffuseColor = new BABYLON.Color3(0.4, 0.6, 0.6);
            ground.material = groundMaterial;
            ground.position.y = -1.5;

            // Create house
            // House base
            const houseBase = BABYLON.MeshBuilder.CreateBox(
                "houseBase",
                { width: 3, height: 2, depth: 3 },
                scene
            );
            houseBase.position.set(0, 0, 8);
            houseBase.checkCollisions = true;
            const houseMaterial = new BABYLON.StandardMaterial("houseMaterial", scene);
            houseMaterial.diffuseColor = new BABYLON.Color3(0.8, 0.6, 0.4);
            houseBase.material = houseMaterial;

            // House roof
            const roof = BABYLON.MeshBuilder.CreateCylinder(
                "roof",
                { diameter: 4.2, height: 2, tessellation: 4 },
                scene
            );
            roof.rotation.z = Math.PI / 2;
            roof.position.set(0, 2, 8);
            roof.checkCollisions = true;
            const roofMaterial = new BABYLON.StandardMaterial("roofMaterial", scene);
            roofMaterial.diffuseColor = new BABYLON.Color3(0.6, 0.2, 0.2);
            roof.material = roofMaterial;

            // Load 3D model (using a publicly available model)
            BABYLON.SceneLoader.ImportMesh("", "https://models.babylonjs.com/", "shark.glb", scene, function (meshes) {
                // Position the model
                meshes[0].position.set(-5, 0, 5);
                meshes[0].scaling = new BABYLON.Vector3(0.5, 0.5, 0.5);
            });

            // Keyboard controls
            const keyState = {};
            const moveSpeed = 0.05;

            window.addEventListener("keydown", function(e) {
                keyState[e.key.toLowerCase()] = true;
            });

            window.addEventListener("keyup", function(e) {
                keyState[e.key.toLowerCase()] = false;
            });

            // Collision flash effect
            let flashTimer = 0;
            const flashDuration = 10; // frames

            // Animate cube
            scene.registerBeforeRender(function() {
                cube.rotation.y += 0.01;
                cube.rotation.x += 0.005;

                // Move cube with WASD (with collision detection)
                const velocity = new BABYLON.Vector3(0, 0, 0);
                
                if (keyState['w']) {
                    velocity.z = moveSpeed;
                }
                if (keyState['s']) {
                    velocity.z = -moveSpeed;
                }
                if (keyState['a']) {
                    velocity.x = -moveSpeed;
                }
                if (keyState['d']) {
                    velocity.x = moveSpeed;
                }
                
                if (velocity.length() > 0) {
                    const oldPosition = cube.position.clone();
                    cube.moveWithCollisions(velocity);
                    
                    // Check if collision occurred (position didn't change as expected)
                    const actualMovement = cube.position.subtract(oldPosition);
                    if (actualMovement.length() < velocity.length() * 0.5) {
                        // Collision detected - trigger flash
                        flashTimer = flashDuration;
                    }
                }
                
                // Handle flash effect
                if (flashTimer > 0) {
                    const intensity = flashTimer / flashDuration;
                    material.emissiveColor = new BABYLON.Color3(intensity, intensity, intensity);
                    flashTimer--;
                } else {
                    material.emissiveColor = new BABYLON.Color3(0.1, 0.2, 0.3);
                }
            });

            return scene;
        };

        const scene = createScene();

        // Render loop
        engine.runRenderLoop(function() {
            // console.log(counter++)
            scene.render();
        });

        // Resize handler
        window.addEventListener("resize", function() {
            engine.resize();
        });
    </script>
</body>
</html>
